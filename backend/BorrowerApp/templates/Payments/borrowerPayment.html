{% extends 'Borrower/borrowerBase.html' %}

{% block title %}Payments - Avendro{% endblock %}

{% block content %}
<div class="max-w-3xl text-gray-600 mx-auto px-4 sm:px-6 lg:px-8 py-6">
    <h2 class="text-xl font-bold text-gray-900 mb-6">Payments</h2>

    <!-- 1. Payment Options -->
    <div class="mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-3">Payment Options</h3>
        <ul class="space-y-2">
            <li class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm flex items-center">
                <i class="fas fa-university text-blue-600 mr-3"></i>
                <span>Bank Transfer (BPI, BDO, Metrobank, etc.)</span>
            </li>
            <li class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm flex items-center">
                <i class="fas fa-credit-card text-green-600 mr-3"></i>
                <span>Credit/Debit Card (Visa, Mastercard)</span>
            </li>
            <li class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm flex items-center">
                <i class="fas fa-wallet text-purple-600 mr-3"></i>
                <span>GCash / PayMaya / Other Payment Gateways</span>
            </li>
            <li class="bg-white border border-gray-100 rounded-xl p-4 shadow-sm flex items-center">
                <i class="fas fa-store text-orange-600 mr-3"></i>
                <span>Over-the-Counter (Banks, Payment Centers)</span>
            </li>
        </ul>
    </div>

    
    
    <!-- 2. Make a Payment -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-8">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Make a Payment</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Select Loan</label>
                <select name="loan_id" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="" disabled selected>Select a loan</option>
                    {% for loan in approved_loans %}
                        <option value="{{ loan.id }}">
                            Loan #{{ loan.id }} - {{ loan.company.company_name }} - ₱{{ loan.amount|floatformat:2 }} ({{ loan.product_type|title }})
                        </option>
                    {% empty %}
                        <option value="" disabled>No approved loans available</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Amount</label>
                <input type="number" name="amount" min="1" step="0.01" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter payment amount">
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Payment Method</label>
                <select name="payment_method" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="" disabled selected>Select method</option>
                    <option value="bank">Bank Transfer</option>
                    <option value="card">Credit/Debit Card</option>
                    <option value="gateway">GCash/PayMaya</option>
                    <option value="otc">Over-the-Counter</option>
                </select>
            </div>
            
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">Payment Reference Number</label>
                <input type="text" name="reference_number" required maxlength="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter transaction/reference number">
                <p class="text-xs text-gray-500 mt-1">Enter the reference number from your payment transaction</p>
            </div>
            
            {% if not approved_loans %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                <p class="text-sm text-yellow-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    You don't have any approved loans to make payments for. Please apply for a loan first.
                </p>
            </div>
            {% endif %}
            
            <div class="mt-6">
                <button type="submit" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:bg-gray-400 disabled:cursor-not-allowed" {% if not approved_loans %}disabled{% endif %}>
                    <i class="fas fa-paper-plane mr-2"></i>Pay Now
                </button>
            </div>
        </form>
    </div>
    
    
   
    <!-- 3. Payment Receipts -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Payment Receipts</h3>
        {% if payments %}
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 rounded-xl shadow-sm bg-white">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Loan ID</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Amount</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Method</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Reference #</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for payment in payments %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">{{ payment.paid_date|date:"M d, Y"|default:payment.due_date|date:"M d, Y" }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">#{{ payment.loan_application.id }}</td>
                            <td class="px-6 py-4 whitespace-nowrap font-semibold">₱{{ payment.amount|floatformat:2 }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">{{ payment.method|title }}</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                {% if payment.reference_number %}
                                    <span class="text-gray-700 font-mono text-sm">{{ payment.reference_number }}</span>
                                {% else %}
                                    <span class="text-gray-400">—</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
                                    {% if payment.status == 'paid' %}bg-green-100 text-green-800
                                    {% elif payment.status == 'pending' %}bg-yellow-100 text-yellow-800
                                    {% else %}bg-red-100 text-red-800{% endif %}">
                                    {{ payment.status|title }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center">
                <h4 class="font-semibold text-yellow-900 mb-2">No Payments Found</h4>
                <p class="text-sm text-yellow-700">You have not made any payments yet.</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}