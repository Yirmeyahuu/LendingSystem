{% extends 'Company/companyBase.html' %}
{% load static %}
{% load humanize %}

{% block title %}Add New Borrower - Avendro{% endblock %}

{% block breadcrumb %}
<li>Borrowers</li>
<li>Add New Borrower</li>
{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Add New Borrower</h1>
        <p class="text-gray-600">Register a new borrower with an approved loan to your portfolio</p>
    </div>

    <!-- Multi-Step Form Container -->
    <form method="POST" id="add-borrower-form" class="space-y-8">
        {% csrf_token %}
        
        <!-- Progress Bar -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
            <div class="mb-4">
                <div class="flex items-center justify-between">
                    <div class="flex-1 flex items-center">
                        <div class="step-indicator active flex items-center justify-center w-10 h-10 rounded-full bg-blue-600 text-white font-bold">1</div>
                        <div class="flex-1 h-1 bg-gray-300 mx-2 step-line"></div>
                    </div>
                    <div class="flex-1 flex items-center">
                        <div class="step-indicator flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 font-bold">2</div>
                        <div class="flex-1 h-1 bg-gray-300 mx-2 step-line"></div>
                    </div>
                    <div class="flex items-center">
                        <div class="step-indicator flex items-center justify-center w-10 h-10 rounded-full bg-gray-300 text-gray-500 font-bold">3</div>
                    </div>
                </div>
                <div class="flex justify-between text-sm mt-3">
                    <span class="step-label text-blue-600 font-semibold text-center w-1/3">Personal Info</span>
                    <span class="step-label text-gray-500 text-center w-1/3">Employment</span>
                    <span class="step-label text-gray-500 text-center w-1/3">Loan Details</span>
                </div>
            </div>
        </div>

        <!-- Step 1: Personal Information -->
        <div class="form-step bg-white rounded-xl shadow-sm border border-gray-100 p-8" id="step-1">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 1: Personal Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Email -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="email">Email Address *</label>
                    <input type="email" id="email" name="email" placeholder="borrower@example.com" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Full Name -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-900 mb-2">Full Legal Name *</label>
                    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                        <input type="text" name="first_name" placeholder="First Name" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="middle_name" placeholder="Middle Name (Optional)" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <input type="text" name="last_name" placeholder="Last Name" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <!-- Date of Birth -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="date_of_birth">Date of Birth *</label>
                    <input type="date" id="date_of_birth" name="date_of_birth" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Gender -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="gender">Gender *</label>
                    <select id="gender" name="gender" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                        <option value="prefer_not_to_say">Prefer not to say</option>
                    </select>
                </div>
                
                <!-- Marital Status -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="marital_status">Marital Status *</label>
                    <select id="marital_status" name="marital_status" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">Select Status</option>
                        <option value="single">Single</option>
                        <option value="married">Married</option>
                        <option value="divorced">Divorced</option>
                        <option value="widowed">Widowed</option>
                        <option value="separated">Separated</option>
                    </select>
                </div>
                
                <!-- Mobile Number -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="mobile_number">Mobile Number *</label>
                    <input type="tel" id="mobile_number" name="mobile_number" placeholder="e.g., (+63) 912-345-6789" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                
                <!-- Current Address -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-900 mb-2">Current Address *</label>
                    <div class="space-y-4">
                        <input type="text" name="current_street_address" placeholder="Street Address" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <input type="text" name="current_city" placeholder="City" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" name="current_state" placeholder="State / Province" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" name="current_postal_code" placeholder="Postal Code" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                
                <!-- Permanent Address Same as Current -->
                <div class="md:col-span-2">
                    <label class="flex items-center">
                        <input type="checkbox" id="same-address" class="h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-2">
                        <span class="text-sm text-gray-900">Permanent address is same as current address</span>
                    </label>
                </div>
                
                <!-- Permanent Address -->
                <div class="md:col-span-2" id="permanent-address-section">
                    <label class="block text-sm font-medium text-gray-900 mb-2">Permanent Address</label>
                    <div class="space-y-4">
                        <input type="text" name="permanent_street_address" placeholder="Street Address" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                            <input type="text" name="permanent_city" placeholder="City" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" name="permanent_state" placeholder="State / Province" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <input type="text" name="permanent_postal_code" placeholder="Postal Code" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-end mt-8">
                <button type="button" class="next-step bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow">
                    Next Step <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Step 2: Employment & Financial Information -->
        <div class="form-step bg-white rounded-xl shadow-sm border border-gray-100 p-8 hidden" id="step-2">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 2: Employment & Financial Information</h2>
            <div class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Employment Status -->
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2" for="employment-status">Employment Status *</label>
                        <select id="employment-status" name="employment_status" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Select Status</option>
                            <option value="employed">Employed</option>
                            <option value="self_employed">Self-Employed</option>
                            <option value="unemployed">Unemployed</option>
                            <option value="student">Student</option>
                            <option value="retired">Retired</option>
                        </select>
                    </div>
                    
                    <!-- Monthly Income -->
                    <div>
                        <label class="block text-sm font-medium text-gray-900 mb-2" for="monthly_income">Monthly Income (₱) *</label>
                        <input type="number" id="monthly_income" name="monthly_income" placeholder="e.g., 50000" min="0" step="0.01" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <!-- Company Name -->
                    <div id="company-field">
                        <label class="block text-sm font-medium text-gray-900 mb-2" for="company_name">Company Name *</label>
                        <input type="text" id="company_name" name="company_name" placeholder="e.g., ABC Corporation" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    
                    <!-- Job Title -->
                    <div id="job-title-field">
                        <label class="block text-sm font-medium text-gray-900 mb-2" for="job_title">Job Title / Position *</label>
                        <input type="text" id="job_title" name="job_title" placeholder="e.g., Software Engineer" class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                
                <!-- Source of Income -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="income_source">Source of Income *</label>
                    <textarea id="income_source" name="income_source" rows="3" placeholder="Briefly describe the primary source of income..." required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-y"></textarea>
                </div>
                
                <!-- Bank Details -->
                <div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Bank Account Details</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2" for="bank_name">Bank Name *</label>
                            <input type="text" id="bank_name" name="bank_name" placeholder="e.g., BDO, BPI, Metrobank" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-900 mb-2" for="account_number">Account Number *</label>
                            <input type="text" id="account_number" name="account_number" placeholder="Account number" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex justify-between mt-8">
                <button type="button" class="prev-step bg-gray-200 text-gray-900 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors font-semibold">
                    <i class="fas fa-arrow-left mr-2"></i> Previous
                </button>
                <button type="button" class="next-step bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow">
                    Next Step <i class="fas fa-arrow-right ml-2"></i>
                </button>
            </div>
        </div>

        <!-- Step 3: Loan Details -->
        <div class="form-step bg-white rounded-xl shadow-sm border border-gray-100 p-8 hidden" id="step-3">
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Step 3: Loan Details</h2>
            
            <!-- Loan Product Type -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-900 mb-2" for="loan_product_type">Loan Product Type *</label>
                <select id="loan_product_type" name="loan_product_type" required class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <option value="">Select Loan Type</option>
                    {% for product in company.loan_products %}
                        <option value="{{ product }}">
                            {% if product == 'personal_loans' %}Personal Loan
                            {% elif product == 'business_loans' %}Business Loan
                            {% elif product == 'auto_loans' %}Auto Loan
                            {% elif product == 'home_loans' %}Home Loan
                            {% elif product == 'salary_loans' %}Salary Loan
                            {% elif product == 'payday_loans' %}Payday Loan
                            {% else %}{{ product|title }}
                            {% endif %}
                        </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <!-- Loan Amount -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="loan_amount">Loan Amount (₱) *</label>
                    <input type="number" id="loan_amount" name="loan_amount" 
                           min="{{ company.min_loan_amount }}" 
                           max="{{ company.max_loan_amount }}" 
                           step="1000"
                           placeholder="Enter amount between ₱{{ company.min_loan_amount|floatformat:0|intcomma }} - ₱{{ company.max_loan_amount|floatformat:0|intcomma }}" 
                           required 
                           class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Min: ₱{{ company.min_loan_amount|floatformat:0|intcomma }} | Max: ₱{{ company.max_loan_amount|floatformat:0|intcomma }}</p>
                </div>
                
                <!-- Loan Term -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="loan_term">Loan Term (months) *</label>
                    <input type="number" id="loan_term" name="loan_term" 
                           min="{{ company.min_loan_term }}" 
                           max="{{ company.max_loan_term }}" 
                           step="1"
                           placeholder="Enter term between {{ company.min_loan_term }} - {{ company.max_loan_term }} months" 
                           required 
                           class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Min: {{ company.min_loan_term }} months | Max: {{ company.max_loan_term }} months</p>
                </div>
                
                <!-- Interest Rate -->
                <div>
                    <label class="block text-sm font-medium text-gray-900 mb-2" for="interest_rate">Interest Rate (%) *</label>
                    <input type="number" id="interest_rate" name="interest_rate" 
                           min="{{ company.min_interest_rate }}" 
                           max="{{ company.max_interest_rate }}" 
                           step="0.01"
                           value="{{ company.min_interest_rate }}"
                           placeholder="Enter rate between {{ company.min_interest_rate }}% - {{ company.max_interest_rate }}%" 
                           required 
                           class="block w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg shadow-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <p class="text-xs text-gray-500 mt-1">Min: {{ company.min_interest_rate }}% | Max: {{ company.max_interest_rate }}%</p>
                </div>
            </div>
            
            <!-- Loan Calculator Results -->
            <div id="loan-calculator" class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-calculator text-blue-600 mr-2"></i>
                    Loan Calculation Preview
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <p class="text-sm text-gray-600 mb-1">Monthly Payment</p>
                        <p class="text-2xl font-bold text-blue-600" id="calc-monthly">₱0.00</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <p class="text-sm text-gray-600 mb-1">Total Payment</p>
                        <p class="text-2xl font-bold text-green-600" id="calc-total">₱0.00</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 shadow-sm">
                        <p class="text-sm text-gray-600 mb-1">Total Interest</p>
                        <p class="text-2xl font-bold text-orange-600" id="calc-interest">₱0.00</p>
                    </div>
                </div>
            </div>
            
            <div class="flex justify-between mt-8">
                <button type="button" class="prev-step bg-gray-200 text-gray-900 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors font-semibold">
                    <i class="fas fa-arrow-left mr-2"></i> Previous
                </button>
                <button type="submit" class="bg-gradient-to-r from-blue-600 to-green-600 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-green-700 transition-all duration-300 font-semibold shadow-lg">
                    <i class="fas fa-user-plus mr-2"></i> Add Borrower with Approved Loan
                </button>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 3;
    const formSteps = document.querySelectorAll('.form-step');
    const stepIndicators = document.querySelectorAll('.step-indicator');
    const stepLabels = document.querySelectorAll('.step-label');
    const stepLines = document.querySelectorAll('.step-line');

    function showStep(stepNumber) {
        formSteps.forEach((step, index) => {
            step.classList.toggle('hidden', index + 1 !== stepNumber);
        });

        stepIndicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index < stepNumber);
            indicator.classList.toggle('bg-blue-600', index < stepNumber);
            indicator.classList.toggle('text-white', index < stepNumber);
            indicator.classList.toggle('bg-gray-300', index >= stepNumber);
            indicator.classList.toggle('text-gray-500', index >= stepNumber);
        });
        
        stepLabels.forEach((label, index) => {
            label.classList.toggle('text-blue-600', index === stepNumber - 1);
            label.classList.toggle('font-semibold', index === stepNumber - 1);
            label.classList.toggle('text-gray-500', index !== stepNumber - 1);
        });
        
        stepLines.forEach((line, index) => {
            line.classList.toggle('bg-blue-600', index < stepNumber - 1);
            line.classList.toggle('bg-gray-300', index >= stepNumber - 1);
        });
    }

    document.querySelectorAll('.next-step').forEach(button => {
        button.addEventListener('click', () => {
            if (validateCurrentStep() && currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
                window.scrollTo(0, 0);
            }
        });
    });

    document.querySelectorAll('.prev-step').forEach(button => {
        button.addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                window.scrollTo(0, 0);
            }
        });
    });

    function validateCurrentStep() {
        const currentStepElement = formSteps[currentStep - 1];
        const requiredFields = currentStepElement.querySelectorAll('[required]');
        let isValid = true;

        requiredFields.forEach(field => {
            field.classList.remove('border-red-500');
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('border-red-500');
            }
        });

        if (!isValid) {
            alert('Please fill in all required fields marked with *');
        }
        return isValid;
    }

    // Address checkbox functionality
    document.getElementById('same-address').addEventListener('change', function() {
        const permanentSection = document.getElementById('permanent-address-section');
        
        if (this.checked) {
            permanentSection.style.display = 'none';
            
            document.querySelector('[name="permanent_street_address"]').value = document.querySelector('[name="current_street_address"]').value;
            document.querySelector('[name="permanent_city"]').value = document.querySelector('[name="current_city"]').value;
            document.querySelector('[name="permanent_state"]').value = document.querySelector('[name="current_state"]').value;
            document.querySelector('[name="permanent_postal_code"]').value = document.querySelector('[name="current_postal_code"]').value;
        } else {
            permanentSection.style.display = 'block';
        }
    });

    // Employment status change
    document.getElementById('employment-status').addEventListener('change', function() {
        const companyField = document.getElementById('company-field');
        const jobTitleField = document.getElementById('job-title-field');
        const companyInput = document.querySelector('[name="company_name"]');
        const jobTitleInput = document.querySelector('[name="job_title"]');

        if (this.value === 'unemployed' || this.value === 'student' || this.value === 'retired') {
            companyField.style.display = 'none';
            jobTitleField.style.display = 'none';
            companyInput.removeAttribute('required');
            jobTitleInput.removeAttribute('required');
            companyInput.value = 'N/A';
            jobTitleInput.value = 'N/A';
        } else {
            companyField.style.display = 'block';
            jobTitleField.style.display = 'block';
            companyInput.setAttribute('required', 'required');
            jobTitleInput.setAttribute('required', 'required');
            if (companyInput.value === 'N/A') companyInput.value = '';
            if (jobTitleInput.value === 'N/A') jobTitleInput.value = '';
        }
    });

    // Loan Calculator
    function calculateLoan() {
        const amount = parseFloat(document.getElementById('loan_amount').value) || 0;
        const term = parseInt(document.getElementById('loan_term').value) || 0;
        const rate = parseFloat(document.getElementById('interest_rate').value) || 0;

        if (amount > 0 && term > 0 && rate >= 0) {
            const monthlyRate = (rate / 100) / 12;
            let monthlyPayment;

            if (monthlyRate > 0) {
                const numerator = monthlyRate * Math.pow(1 + monthlyRate, term);
                const denominator = Math.pow(1 + monthlyRate, term) - 1;
                monthlyPayment = amount * (numerator / denominator);
            } else {
                monthlyPayment = amount / term;
            }

            const totalPayment = monthlyPayment * term;
            const totalInterest = totalPayment - amount;

            document.getElementById('calc-monthly').textContent = '₱' + monthlyPayment.toLocaleString('en-PH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('calc-total').textContent = '₱' + totalPayment.toLocaleString('en-PH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            document.getElementById('calc-interest').textContent = '₱' + totalInterest.toLocaleString('en-PH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }
    }

    document.getElementById('loan_amount').addEventListener('input', calculateLoan);
    document.getElementById('loan_term').addEventListener('input', calculateLoan);
    document.getElementById('interest_rate').addEventListener('input', calculateLoan);

    showStep(currentStep);
});
</script>
{% endblock %}